<!DOCTYPE html><html><head>
    <style>
        html {
            font-size: 62.5%;
        }
        body {
            font-size: 1.5em;
            line-height: 1.6;
            font-weight: 400;
            font-family: "SF Pro Text", "SF Pro Icons", "Helvetica Neue", "Helvetica", "Arial", sans-serif;
            margin: 0;
            padding: 0;
            color: #777;
            background: #ecf0f3;
        }
        #section_container {
            position: relative;
            background: #ecf0f3;
        }
        #background {
            background: #ebedef;
            border-left: 1px solid #e2e2eb;
            position: absolute;
            top: 0;
            left: 40%;
            right: 0;
            bottom: 0;
            z-index: 0;
            display: none;
        }
        @media (min-width: 768px) {
            #background {
                display: block;
            }
        }
        a {
            color: #666;
        }
        a:visited {
            color: #777;
        }
        a.parent {
            text-transform: uppercase;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
            text-decoration: none;
        }
        a.parent:after {
            content: ">";
            font-size: 14px;
            margin-left: 4px;
        }
    </style>
    
    <style>
        div.section:hover {
            background: #f8fafb;
        }
        div.section {
            position: relative;
        }
        div.section:after {
            clear: both;
            content: "";
            display: block;
        }
        div.section {
            border-top: 1px solid #e2e2eb;
        }
        div.footer {
            margin-top: 25px;
            position: relative;
            padding: 10px 0;
            text-align: center;
        }
        div.footer a {
            display: inline-block;
            margin: 8px;
            font-size: 1.3rem;
        }
        div.footer {
            background: #d5dbe0;
        }
    </style>
    <style>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }

.highlight .c { color: #3D7B7B; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #9C6500 } /* Comment.Preproc */
.highlight .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.highlight .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #E40000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #008400 } /* Generic.Inserted */
.highlight .go { color: #717171 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #687822 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #717171; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #767600 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #A45A77 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
        <style>
        div.section:hover div.code {
            background: #f8fafb;
        }
        div.section div.code {
            background: #ebedef;
              padding: 14px 8px 16px 15px;
              vertical-align: top;
        }
        @media (min-width: 768px) {
            div.section div.code {
                margin-left: 40%;
            }
        }
        </style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/mathtex-script-type.min.js" defer></script>
        <style>
            div.section div.doc {
                box-sizing: border-box;
                padding: 10px 8px 1px 8px;
                vertical-align: top;
                text-align: left;
                word-break: break-all;
            }
        @media (min-width: 768px) {
            div.section div.doc {
                float: left;
                width: 40%;
                min-height: 5px;
            }
        }
        @media (min-width: 1024px) {
            div.section div.doc {
                padding: 10px 25px 1px 50px;
            }
        }
        div.section div.doc img {
            max-width: 100%;
            transition:transform 0.25s ease;
        }
        img:hover {
            -webkit-transform:scale(1.75);
            transform:scale(1.75);
        }        
        </style>
        </head><body><div id="section_container"><div id="background"></div>
    <div class="section" id="0">
        
        <div class="doc">
            <p><a class="parent" href="../../index.html">Home</a><a class="parent" href="../index.html">Network</a><a class="parent" href="index.html">HITNet</a></p>
        </div>
        
    </div>
    
    <div class="section" id="1">
        
        <div class="doc">
            <p><br><br><br>(1) By default, the HITNet architecture is implemented with a 5-scale feature extractor   with 16, 16, 24, 24, 32 channels at corresponding resolutions.  <br>In more details, one down-sampling block of the U-Net has a single 3 × 3 convolution   followed by a 2 × 2 convolution with stride 2. One up-sampling block ap- plies 2 × 2 stride 2 transpose convolutions  to up-sample re- sults of coarser U-Net resolution.  </p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">import</span> <span class="nn">torch</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">source.Network.base_network</span> <span class="kn">import</span> <span class="n">BaseNetwork</span>


<span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="2">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UpsampleBlock</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="3">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_in</span><span class="p">,</span> <span class="n">channel_out</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="4">
        
        <div class="doc">
            <p>Features are concatenated with skip-connection, and a 1 × 1 convolution followed by a 3 × 3 convolution  are applied to merge the skipped and upsampled feature for the current resolution.</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">channel_out</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">channel_out</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">channel_out</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">channel_out</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">channel_out</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">channel_out</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(),</span>
        <span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="5">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skip_connection</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="6">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="7">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="8">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="9">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Conv2DSamePadding</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">bias</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stride</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="10">
        
        <div class="doc">
            <p>Necessary function since PyTorch does not support padding in nn.Conv2d with a sequence of padding settings. Output resolution</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="n">out_height</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">out_width</span>  <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">stride</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="11">
        
        <div class="doc">
            <p>Compute necessary padding on each side</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="n">padding_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">out_height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">padding_width</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">out_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="12">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hyp_up</span><span class="p">(</span><span class="n">hyp</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tile_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="13">
        
        <div class="doc">
            <p>A high resolution disparity initialization step utilizes features to retrieve feasible hypothesis. The initialization step runs on each scale of the extraced feature. This step operates on tiles of 4x4 feature regions and evaluates multiple disparity hypotheses. The disparity with the minimum cost is selected.  Goal of initialization step is to retrieve an initial disparity and feature vector for each tile at various resolutions. The output of the initialization  is fronto-parallel tile hypotheses of the form [d_init, 0, 0, p_init].  Computation of the initial disparity value: Overlapping tiles along the x direction in the right image and non-overlapping tiles in the left.  Run 4x4 kernel on each extracted feature map. The strides for the left and right image are different to facilitate the aforementioned overlapping tiles. Stride for the left image uses 4x4 and for the right image 4x1.  Convolution is followed by a leakyRelu and an MLP.   Output of the initialization is then passed to a propagation stage, which acts similarly to the approximated Conditional Random Field solution.</p>
        </div>
        
        
        <div class="code">
            
        </div>
        
    </div>
    
    <div class="section" id="14">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Initialization</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="15">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">intermediate_channels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reference_channels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_disparity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="16">
        
        <div class="doc">
            <p>Tile Disparity</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv_tile_features</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
            <span class="n">in_channels</span><span class="o">=</span><span class="n">in_channels</span><span class="p">,</span>
            <span class="n">out_channels</span><span class="o">=</span><span class="n">intermediate_channels</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mlp_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">intermediate_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">intermediate_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="c1"># Acts like a MLP on images?</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">()</span>
        <span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="17">
        
        <div class="doc">
            <p>CostVolume</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">max_disp</span> <span class="o">=</span> <span class="n">max_disparity</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="18">
        
        <div class="doc">
            <p>Tile Feature Descriptor "Tile descriptor has 13 channels by default."</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv_perc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
                <span class="n">in_channels</span><span class="o">=</span><span class="n">reference_channels</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="c1"># +1 because of concatenating with cost volume value</span>
                <span class="n">out_channels</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
                <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">()</span>
        <span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="19">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features_left</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">features_right</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">features_reference</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="20">
        
        <div class="doc">
            <p>Tile Disparity  Left</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">_left</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">features_left</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_tile_features</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_tile_features</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlp_conv</span><span class="p">(</span><span class="n">_left</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="21">
        
        <div class="doc">
            <p>Right</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">_right</span> <span class="o">=</span> <span class="n">Conv2DSamePadding</span><span class="p">(</span><span class="n">features_right</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_tile_features</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_tile_features</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlp_conv</span><span class="p">(</span><span class="n">_right</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="22">
        
        <div class="doc">
            <p>Cost volume: [B, C, D, H_left, W_left]</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">cost_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_cost_volume</span><span class="p">(</span><span class="n">_left</span><span class="p">,</span> <span class="n">_right</span><span class="p">)</span>
        <span class="n">cost_volume</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cost_volume</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="23">
        
        <div class="doc">
            <p>Min over disparity channel</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">cost_function</span><span class="p">,</span> <span class="n">disp_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cost_volume</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="24">
        
        <div class="doc">
            <p>Tile Feature descriptor Feature are base don the embedding vector of the reference image and the costs of the best matching disparity</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">p_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">cost_function</span><span class="p">,</span> <span class="n">features_reference</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_perc</span><span class="p">(</span><span class="n">p_init</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="25">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">compute_cost_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_feature</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">right_feature</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="26">
        
        <div class="doc">
            <p>Build up cost volume for right feature map</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">disparity_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_disp</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">left_feature</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="c1"># 1-Dim at this point</span>
        <span class="n">disparity_range</span> <span class="o">=</span> <span class="n">disparity_range</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>                    <span class="c1"># 5-Dim with vals at 3rd dim?</span>
        <span class="n">width_range</span>     <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">left_feature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">left_feature</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="c1"># -...-</span>
        <span class="n">width_range</span>     <span class="o">=</span> <span class="n">width_range</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="27">
        
        <div class="doc">
            <p>Build indices for right feature set according to formula. </p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">x_index</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">width_range</span> <span class="o">-</span> <span class="n">disparity_range</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">right_feature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">x_index</span> <span class="o">=</span> <span class="n">x_index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">right_feature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right_feature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right_feature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># right_feature.shape[2] is used because of missing disp dim</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="28">
        
        <div class="doc">
            <p>Return: ||e^L_l,x,y - e^R_l,4x-d,y||</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="k">return</span> <span class="n">left_feature</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">right_feature_</span> 
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="29">
        
        <div class="doc">
            <p>Creates patch coordinates for the corresponding (scale x scale) local disparity map.</p>
<p>Args:
    scale (int): Size (x and y direction) of corresponding patch.</p>
<p>Returns:
    coef_x (torch.Tensor [1, (scale x scale), 1, 1]): X coordinates for local disparity map patch.
    coef_y (torch.Tensor [1, (scale x scale), 1, 1]): Y coordinates for local disparity map patch.</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_patch_coordinates</span><span class="p">(</span><span class="n">scale</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="30">
        
        <div class="doc">
            <p>Compute the indices for the patch coordinates used in formula (5) in the paper.</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">scale</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="31">
        
        <div class="doc">
            <p>Create and return all possible combinations of coordinates </p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="n">coef_y</span><span class="p">,</span> <span class="n">coef_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
    <span class="n">coef_x</span> <span class="o">=</span> <span class="n">coef_x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">coef_y</span> <span class="o">=</span> <span class="n">coef_y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coef_x</span><span class="p">,</span> <span class="n">coef_y</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="32">
        
        <div class="doc">
            <p>Upscaling the initial disparity value according to the gradient in x and y direction of the hypothesis itself.</p>
<p>Args:
    d (torch.Tensor): Disparity part of tile hypothesis.
    dx (torch.Tensor): Gradient of disparity in x direction.
    dy (torch.Tensor): Gradient of disparity in y direction.
    scale (int): Expected upsampling scale for disparity map.
    expand_tile (bool): </p>
<p>Returns:
    disp_upscaled (torch.Tensor): Upscaled disparity map.</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">disparity_upscale</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">expand_tile</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="33">
        
        <div class="doc">
            <p>Compute local disparity map for each tile hypothesis</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">expand_tile</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="p">(</span><span class="n">patch_coords_x</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">patch_coords_y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="34">
        
        <div class="doc">
            <p>@todo: What happens here? Why multiplying with 4?</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">patch_coords_x</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">patch_coords_y</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="35">
        
        <div class="doc">
            <p>Reshape current order from (N, (scaleXscale), H, W) to (N, 1, Hscale, Wscale)</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="n">N</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">H</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">W</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="36">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">warp_and_aggregate</span><span class="p">(</span><span class="n">hypothesis</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">left_feature</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">right_feature</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="37">
        
        <div class="doc">
            <p>Compute the scale between original resolution of feature vector and hypothesis disparity</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="n">scale</span> <span class="o">=</span> <span class="n">left_feature</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">//</span> <span class="n">hypothesis</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="38">
        
        <div class="doc">
            <p>@note: Currently, the assumption is that scale == 4 because due to the size of the 4x4 kernel used before</p>
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">assert</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="39">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ResBlock</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="40">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="41">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="42">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PropagationNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="43">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dilations</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="44">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyp</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="45">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyps</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="46">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefinementNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="47">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cin</span><span class="p">,</span> <span class="n">cres</span><span class="p">,</span> <span class="n">dilations</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="48">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hpy</span><span class="p">,</span> <span class="n">left</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="49">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_HITNet</span><span class="p">(</span><span class="n">BaseNetwork</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="50">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="51">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_img</span><span class="p">,</span> <span class="n">right_img</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="52">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HITNet</span><span class="p">(</span><span class="n">_HITNet</span><span class="p">):</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="section" id="53">
        
        <div class="doc">
            
        </div>
        
        
        <div class="code">
            <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>

        </div>
        
    </div>
    
    <div class="footer">
        <a href="mailto:thomas.buechler@cariad.technology">Contact</a>
    </div>
    </div></body></html>
    